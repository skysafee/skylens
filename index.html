<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>SkyLens</title>

  <!-- Theme variables live in style.css -->
  <link rel="stylesheet" href="style.css" />

  <meta name="theme-color" content="#0f1724" />
</head>
<body class="theme-default no-auth">

  <!-- TOP NAV -->
  <header class="topbar" role="banner" aria-hidden="false">
    <div class="topbar-inner">
      <div class="brand" aria-label="SkyLens home">
        <svg width="28" height="28" viewBox="0 0 24 24" aria-hidden="true"><path fill="currentColor" d="M12 2L2 7v6c0 5 6 9 10 9s10-4 10-9V7L12 2z"/></svg>
        <span class="app-name">SkyLens</span>
      </div>

      <div class="top-right" aria-hidden="false">
        <select id="themeSelect" class="control theme-select" aria-label="Select theme">
          <option value="default">Default</option>
          <option value="dark">Dark</option>
          <option value="ocean">Ocean</option>
          <option value="sunset">Sunset</option>
        </select>

        <button id="logoutButton" class="control icon-btn" title="Logout" aria-label="Logout">
          <svg width="18" height="18" viewBox="0 0 24 24" aria-hidden="true"><path fill="currentColor" d="M16 13v-2H7V8l-5 4 5 4v-3zM20 3h-8v2h8v14h-8v2h8a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2z"/></svg>
        </button>
      </div>
    </div>
  </header>

  <!-- OFFLINE BANNER -->
  <div id="offlineStatus" class="offline-banner hidden" aria-hidden="true">You're offline</div>

  <!-- FULLSCREEN DROP OVERLAY (shows on drag anywhere) -->
  <div id="fullDropOverlay" class="full-drop-overlay hidden" aria-hidden="true">
    <div class="full-drop-inner" role="region" aria-label="Drop files to upload">
      <svg width="56" height="56" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M12 3v10" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M7 10l5 5 5-5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
      <div class="drop-text-lg">Drop here to upload</div>
      <div class="drop-sub">Release to upload files to SkyLens</div>
    </div>
  </div>

  <main class="page" role="main">
    <noscript>
      <div style="margin:18px auto; max-width:900px; text-align:center; color:#ffdede; background:rgba(0,0,0,0.4); padding:10px; border-radius:8px;">
        SkyLens requires JavaScript. Please enable JavaScript to use the gallery.
      </div>
    </noscript>

    <!-- AUTH / LOGIN CARD -->
    <section id="authSection" class="auth-wrap center-card" aria-labelledby="authTitle">
      <div class="auth-card" role="form" aria-describedby="authError">
        <h1 id="authTitle">Login to SkyLens</h1>

        <form id="loginForm" class="form">
          <div class="field">
            <label for="username" class="visually-hidden">Username</label>
            <input id="username" name="username" type="text" placeholder="Username" autocomplete="username" required />
          </div>

          <div class="field">
            <label for="password" class="visually-hidden">Password</label>
            <input id="password" name="password" type="password" placeholder="Password" autocomplete="current-password" required />
          </div>

          <!-- Confirm password (hidden by default; JS toggles visibility) -->
          <div id="signupFields" class="hidden">
            <div class="field">
              <label for="confirmPassword" class="visually-hidden">Confirm password</label>
              <input id="confirmPassword" type="password" placeholder="Confirm password" autocomplete="new-password" />
            </div>
          </div>

          <div id="authError" class="form-error" aria-live="polite"></div>

          <div class="actions" style="display:flex; gap:10px; align-items:center; margin-top:8px;">
            <button id="authSubmitBtn" type="submit" class="btn primary">Continue</button>
            <button id="signupToggleBtn" type="button" class="btn ghost">Create account</button>
          </div>
        </form>
      </div>
    </section>

    <!-- GALLERY -->
    <section id="gallerySection" class="gallery-wrap hidden" aria-live="polite">
      <div id="dropZone" class="dropzone hidden" aria-hidden="true">
        <div class="dropzone-inner">
          <input id="imageInput" type="file" accept="image/*" multiple class="hidden" />
          <div class="drop-text">Drag & drop images here or <button id="browseBtn" class="link" type="button">browse</button></div>
        </div>
      </div>

      <div id="gallery" class="gallery-grid" aria-live="polite" aria-label="Image gallery"></div>

      <div class="gallery-footer">
        <button id="loadMoreBtn" class="btn outline hidden" type="button">Load more</button>
        <div id="loadingSpinner" class="spinner hidden" aria-hidden="true" role="status" aria-label="Loading"></div>
      </div>
    </section>
  </main>

  <!-- LIGHTBOX / VIEWER -->
  <div id="lightbox" class="lightbox hidden" role="dialog" aria-modal="true" aria-label="Image viewer">
    <button class="lightbox-close icon-btn" onclick="closeLightbox()" aria-label="Close">✕</button>
    <button class="lightbox-nav prev" onclick="prevImage()" aria-label="Previous">‹</button>

    <div class="lightbox-content">
      <img id="lightboxImage" src="" alt="Full image" />
      <!-- Note button replaces auto-loading of notes; Delete remains -->
      <div class="lightbox-actions" style="display:flex; gap:10px; margin-top:10px;">
        <button id="openNoteBtn" class="btn" type="button" aria-haspopup="dialog">Note</button>
        <button id="deleteImageBtn" class="btn danger" type="button">Delete</button>
      </div>
    </div>

    <button class="lightbox-nav next" onclick="nextImage()" aria-label="Next">›</button>
  </div>

  <!-- NOTE MODAL (fetch on demand) -->
  <div id="noteModal" class="modal hidden" aria-hidden="true" role="dialog" aria-modal="true" aria-label="Image note">
    <div class="modal-inner" style="max-width:720px; width:94%; padding:18px; background:var(--card); border-radius:12px;">
      <div style="display:flex; align-items:center; justify-content:space-between; gap:12px; margin-bottom:8px;">
        <h3 id="noteModalTitle" style="margin:0; font-size:1.05rem;">Note</h3>
        <div style="display:flex; gap:8px; align-items:center;">
          <button id="noteCloseBtn" class="icon-btn" aria-label="Close note">✕</button>
        </div>
      </div>

      <div id="noteView" style="white-space:pre-wrap; color:var(--text); min-height:80px; padding:10px; background:transparent; border-radius:8px; border:1px solid rgba(255,255,255,0.03);"></div>

      <textarea id="noteTextarea" class="hidden" style="width:100%; min-height:120px; margin-top:8px; padding:10px; border-radius:8px; display:block; background:var(--surface); color:var(--text); border:1px solid rgba(255,255,255,0.03);"></textarea>

      <div style="display:flex; gap:8px; justify-content:flex-end; margin-top:12px;">
        <button id="noteEditBtn" class="btn" type="button">Edit</button>
        <button id="noteSaveBtn" class="btn primary hidden" type="button">Save</button>
      </div>
    </div>
  </div>

  <!-- CAMERA MODAL -->
  <div id="cameraModal" class="modal hidden" aria-hidden="true" role="dialog" aria-modal="true" aria-label="Camera capture">
    <div class="modal-inner center">
      <video id="cameraPreview" autoplay playsinline style="width:100%; max-width:420px; border-radius:10px;"></video>
      <div class="camera-actions" style="margin-top:10px;">
        <button id="captureBtn" class="btn" type="button">Capture</button>
        <button id="closeCameraBtn" class="btn ghost" type="button">Close</button>
      </div>
    </div>
  </div>

  <!-- FLOATING ACTION BUTTON -->
  <div class="fab-wrap" aria-hidden="false">
    <button id="fabOpen" class="fab" title="Upload or capture" aria-label="Upload or capture">
      <svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true"><path fill="currentColor" d="M12 5v14m7-7H5"/></svg>
    </button>

    <div id="fabOptions" class="fab-options hidden" aria-hidden="true">
      <label for="imageInput" id="fabUploadLabel" class="fab-option" role="button" tabindex="0">Upload</label>
      <button id="openCameraBtn" class="fab-option" type="button">Camera</button>
    </div>
  </div>

  <div id="toast" class="toast hidden" role="status" aria-live="polite" aria-atomic="true"></div>

  <script src="script.js" defer></script>
</body>
</html>
